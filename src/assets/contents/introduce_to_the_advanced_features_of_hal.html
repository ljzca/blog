In <a href="http://ljzca.blogspot.ca/2017/03/get-start-with-hal.html" target="_blank">Get Start with HAL</a>, I went through the basic steps to setup a Spring Boot project and get HAL resource to work. This article is for you to check out some relatively advanced features used in a real word project called <a href="https://github.com/ljzca/capstone" target="_blank">STARS</a>. The features to be introduced include typical structure of an HAL project, handling composite primary keys, applying security constraints and so on.<br>
<h2>
Prerequisite</h2>
To be able to understand this article, you need to know the basis of <a href="http://ljzca.blogspot.ca/search/label/HAL" target="_blank">HAL</a>, <a href="http://ljzca.blogspot.ca/search/label/Database" target="_blank">Database</a>, and <a href="http://ljzca.blogspot.ca/search/label/AOP" target="_blank">Aspect Oriented Programming</a>. You can find more information by following the link on each topic. In addition, since this article references a lot of code in project <a href="https://github.com/ljzca/capstone" target="_blank">STARS</a>, you may also need a runtime to <a href="https://github.com/ljzca/capstone/archive/1.0.0-Alpha.zip" target="_blank">download</a> and run the project.<br>
<h2>
Example Project Synopsis</h2>
<a href="https://github.com/ljzca/capstone" target="_blank">Sport Telemetry and Report System</a> (<a href="https://github.com/ljzca/capstone" target="_blank">STARS</a>), a project adopting <a href="http://ljzca.blogspot.ca/search/label/HAL" target="_blank">HAL</a>, provides a web portal for users to store, manage, review and analyze the movement trajectory and body positioning data of their sport sessions. The version to be referencing in this article is <a href="https://github.com/ljzca/capstone/tree/1.0.0-Alpha" target="_blank">v1.0.0-Alpha</a>.<br>
<h2>
Structure of an HAL project</h2>
As a standard of RESTful Web Services, HAL inherits characteristics of REST, i.e. a clear separation between frontend and backend makes an HAL project to be standalone. It doesn't care what type of clients to cooperate with.<br>
As a Java implementation of HAL, <a href="http://spring.io/" target="_blank">Spring Framework</a> features HAL through <a href="http://projects.spring.io/spring-data-rest/" target="_blank">Spring Data REST</a>. To better provide HAL standardized web API, <a href="http://projects.spring.io/spring-data-rest/" target="_blank">Spring Data REST</a> adopts <a href="http://ljzca.blogspot.ca/search/label/AOP" target="_blank">aspect oriented programing</a> (<a href="http://ljzca.blogspot.ca/search/label/AOP" target="_blank">AOP</a>) paradigm. Unlike traditional layered architecture, <a href="http://ljzca.blogspot.ca/search/label/AOP" target="_blank">AOP</a> allows developers to focus on special operations. Spring HAL automatically provides default CRUD operations. They are interceptable on different aspects to enable customized security constraints, content manipulations, associated operations, and so on.<br>
<h2>
Handling Composite Key</h2>
Composite Primary Key is a very common practice in database. To get it to work with <a href="http://ljzca.blogspot.ca/search/label/HAL" target="_blank">HAL</a>, there are 3 things you need to take care of: embedded primary key, JSON Representation, and conversion.<br>
<h3>
Embedded Primary Key</h3>
In JPA, composite primary key is also called embedded id, which is a special object containing all the columns of the primary key. In the <a href="https://github.com/ljzca/capstone/tree/1.0.0-Alpha" target="_blank">example project</a>, <a href="https://github.com/ljzca/capstone/blob/1.0.0-Alpha/src/main/java/ca/sait/stars/domains/Record.java" target="_blank">Record</a> is a domain class representing the table stars_record, which has owner and title columns as a composite primary key. To represent this composite primary key, we need a special object called <a href="https://github.com/ljzca/capstone/blob/1.0.0-Alpha/src/main/java/ca/sait/stars/domains/RecordPK.java" target="_blank">RecordPK</a> as an embedded id.<br>
<h3>
JSON Representation</h3>
Once you have the embedded id, the project still cannot work as expected because it doesn't know how to represent id in the self-reflect URL since the id contains more than one part. To specify the format of the id, you need to override toString method in the embedded id object. Check toString() in <a href="https://github.com/ljzca/capstone/blob/1.0.0-Alpha/src/main/java/ca/sait/stars/domains/RecordPK.java" target="_blank">RecordPK</a>, you will find that each part of composite key is delimited by &amp; sign.<br>
<h3>
PK Conversion</h3>
So far, we have the way to represent composite primary key properly. The last thing is to convert the self-reflect URL back to the embedded id object. To do that, you need to implement a <a href="https://github.com/ljzca/capstone/blob/1.0.0-Alpha/src/main/java/ca/sait/stars/domains/converters/CompositePKConverter.java" target="_blank">BackendIdConverter</a> as a service. You should list all the domains that contain embedded id, and provide convertors for them. In addition, link toString method of embedded id objects to this service to make self-reflect URL to be properly displayed.<br>
<h2>
Apply Security Check</h2>
In <a href="http://projects.spring.io/spring-data-rest/" target="_blank">Spring Data REST</a>, the most common practice of securing the application would be just using <a href="https://projects.spring.io/spring-security/" target="_blank">Spring Security</a>. This article is not about <a href="https://projects.spring.io/spring-security/" target="_blank">Spring Security</a>, but the idea of how to apply it in an HAL project. So, if you are interested in how it is configured in the example project, you can still trace from <a href="https://github.com/ljzca/capstone/blob/1.0.0-Alpha/src/main/java/ca/sait/stars/security/configurations/WebSecurityConfig.java" target="_blank">WebSecurityConfig.java</a> and read the comments.<br>
To apply security on <a href="https://github.com/ljzca/capstone/blob/1.0.0-Alpha/src/main/java/ca/sait/stars/domains/Record.java" target="_blank">Record</a> for example, you need to know what methods of the <a href="https://github.com/ljzca/capstone/blob/1.0.0-Alpha/src/main/java/ca/sait/stars/repositories/RecordRepository.java" target="_blank">repository</a> are provided by Spring. As we declared the interface <a href="https://github.com/ljzca/capstone/blob/1.0.0-Alpha/src/main/java/ca/sait/stars/repositories/RecordRepository.java" target="_blank">RecordRepository</a>, Spring will proxy this interface and its methods, and provides HAL REST APIs. You will find all the methods in <a href="https://github.com/ljzca/capstone/blob/1.0.0-Alpha/src/main/java/ca/sait/stars/repositories/RecordRepository.java" target="_blank">RecordRepository.java</a>.<br>
From previous section, we talked about <a href="http://ljzca.blogspot.ca/search/label/AOP" target="_blank">AOP</a>. In <a href="https://github.com/ljzca/capstone/blob/1.0.0-Alpha/src/main/java/ca/sait/stars/repositories/RecordRepository.java" target="_blank">RecordRepository</a>, I used annotations as the way to adopt <a href="http://ljzca.blogspot.ca/search/label/AOP" target="_blank">AOP</a> to interfere the invocation of each method. <code>@PreAuthorize</code> is the only annotation I used for security check, although, there are many other annotations can be used in different scenario.<br>
Instead of explaining every single annotation and its value, I would like to just pick a typical one:<br>
<pre>@Override
@PreAuthorize("hasRole('ADMIN')")
Iterable&lt;Record&gt; findAll();
</pre>
This method provides a web interface to return all the records in a JSON format when an HTTP GET request being sent to <code>http://localhost:8080/rest/records</code>. If there is no <code>@PreAuthorize</code> annotation, anyone can get all records in the system, which should not be the case. We want only admin users to be able to perform this query. So, by saying <code>"hasRole('ADMIN')"</code>, users without admin privilege will not be allowed to invoke this method. In this way, the project can be secured safely and efficiently.<br>
<h2>
Conclusion</h2>
In this article, we went through some advanced, but also commonly used features of <a href="http://projects.spring.io/spring-data-rest/" target="_blank">Spring Data REST</a>, which is a Java implementation of <a href="http://ljzca.blogspot.ca/search/label/HAL" target="_blank">HAL</a>. Since <a href="http://ljzca.blogspot.ca/search/label/HAL" target="_blank">HAL</a> and <a href="http://projects.spring.io/spring-data-rest/" target="_blank">Spring Data REST</a> are really big topics, I'm sure you will find more when doing the actual development. However, this article talks about the most important concepts you have to know, and I hope you enjoy working with <a href="http://ljzca.blogspot.ca/search/label/HAL" target="_blank">HAL</a>.